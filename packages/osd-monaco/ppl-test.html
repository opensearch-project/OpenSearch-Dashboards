<!DOCTYPE html>
<html>
<head>
    <title>PPL Monaco Editor Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #editor {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }
        .controls {
            margin-bottom: 10px;
        }
        button {
            margin-right: 10px;
            padding: 8px 16px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>PPL Monaco Editor Test</h1>
    
    <div class="controls">
        <button onclick="testBasicPPL()">Test Basic PPL Query</button>
        <button onclick="testPPLWithErrors()">Test PPL with Syntax Errors</button>
        <button onclick="clearEditor()">Clear Editor</button>
    </div>
    
    <div id="editor"></div>
    
    <div class="status">
        <strong>Status:</strong> <span id="status">Loading...</span>
    </div>

    <script>
        // This test file should be served from a local server to work properly
        // You can use: python3 -m http.server 8000
        
        let editor;
        const statusEl = document.getElementById('status');
        
        function updateStatus(message) {
            statusEl.textContent = message;
            console.log('Status:', message);
        }
        
        // Sample PPL queries for testing
        const sampleQueries = {
            basic: `source=logs | where level="ERROR" | stats count(*) by service | sort count desc`,
            withErrors: `source=logs | where level=ERROR | stats count(*) by service | sort count desc missing_keyword`
        };
        
        function testBasicPPL() {
            editor.setValue(sampleQueries.basic);
            updateStatus('Loaded basic PPL query');
        }
        
        function testPPLWithErrors() {
            editor.setValue(sampleQueries.withErrors);
            updateStatus('Loaded PPL query with syntax errors');
        }
        
        function clearEditor() {
            editor.setValue('');
            updateStatus('Editor cleared');
        }
        
        // Initialize Monaco Editor with PPL support
        async function initializeEditor() {
            try {
                updateStatus('Initializing Monaco Editor...');
                
                // Import Monaco from the built package
                const { monaco, PPLLang } = await import('./target/web/index.js');
                
                updateStatus('Monaco imported, creating editor...');
                
                // Create editor instance
                editor = monaco.editor.create(document.getElementById('editor'), {
                    language: PPLLang.ID,
                    theme: 'vs-dark',
                    value: '// PPL Editor is ready!\n// Try typing a PPL query like:\n// source=logs | fields timestamp, message | head 10',
                    automaticLayout: true,
                    minimap: { enabled: false },
                    lineNumbers: 'on',
                    roundedSelection: false,
                    scrollBeyondLastLine: false,
                    readOnly: false,
                    fontSize: 14,
                });
                
                updateStatus('PPL Monaco Editor initialized successfully!');
                
                // Test worker communication
                setTimeout(() => {
                    testBasicPPL();
                    updateStatus('PPL Monaco Editor ready - worker syntax highlighting active');
                }, 1000);
                
            } catch (error) {
                updateStatus('Error initializing Monaco Editor: ' + error.message);
                console.error('Monaco initialization error:', error);
            }
        }
        
        // Start initialization when page loads
        document.addEventListener('DOMContentLoaded', initializeEditor);
    </script>
</body>
</html>
